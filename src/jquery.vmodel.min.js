/*!  2016-06-24 */
!function(a){var b="1.6.0",c={};a.vmodel={},a.vmodel.api=new function(){this.remove_sign=function(a){return"--"==a.substring(0,2)?a.substring(2):a},this.isallow_jqver=function(b){if(1==b)return"Vmodel.js "+a.vmodel.version()+" 須要使用大於 jQuery 3.0.0 的版本";var c=jQuery.fn.jquery.charAt(0);return 3==c?!0:!1},this.check_input_param=function(a){if(!a.selector)throw"須要指定選擇器";if(!a.model_name)throw"須要替模型命名";if(void 0===a.isautoload)throw"須要指定是否啟用";if(!a.method)throw"須要指定方法"},this.vmodel_param_match=function(b,c,d,e){var f=b,g=this.remove_sign(c),h=d,i="object"===a.type(e)?e:new e;return[f,g,h,i]},this.obj_sort=function(b){var c=[],d=0;a.each(b,function(a,b){c[d++]=a}),c.sort();var e={};return a.each(c,function(a,c){e[c]=b[c]}),e},this.each_autoload=function(b,c){return b?(a.each(b,function(b,d){return"function"!=a.type(c[d])?(local.msg_error(d,"不存在。"),!1):void c[d]()}),!0):!1},this.is_trigger_autoload=function(b,c){try{if(!c)throw"須要指定方法名稱陣列";if("array"!=a.type(c))throw"is_trigger_autoload() 代入的方法名稱必須要是陣列";a.vmodel.api.each_autoload(c,b);return!0}catch(d){return console.log(d),!1}},this.get_autoload_funame=function(b){var c=[],d=a.type(b.autoload);try{if("array"==d)c=b.autoload;else{if("function"!=d)throw b.vname+" 的 autoload 須要是陣列或 function。";if(res=b.autoload(),"array"!=a.type(res))throw b.vname+" 的 get_autoload_funame() 最終需要得到的型態應該是陣列。";c=res}return c}catch(e){return console.log(e),!1}}},a.vmodel.version=function(){return b},a.vmodel.end=function(b,c){var d=this;this.param_match=function(b,c){var d=[];if("function"==a.type(b)){var e=a.vmodel.get();d=[e,b]}else{var f={};a.each(b,function(b,c){f[c]=a.vmodel.get(c)}),d=[f,c]}return d};var e=d.param_match(b,c),f=e[0],g=e[1];b=c=null;var h=setInterval(function(){var b=!0;a.each(f,function(c,d){var e=a.vmodel.history(d.vname);return 0==e?(b=!1,!0):void(b=!0)}),b&&(g(f),clearInterval(h))},0)},a.vmodel.history=function(b){var c=!1,d=a.vmodel.get(b),e=d.root.attr("data-vmodel-history");if(!e)return!1;var f=a.parseJSON(e);return a.each(f,function(a,d){return d.vname!=b?!0:(c=d,!1)}),c},a.vmodel.get=function(b,d,e){var f=this;this.chk_trigger_callback=function(b){var c=!0;return a.each(b.fun_struct,function(a,b){return 0==b?(c=!1,!1):void 0}),0==c?!1:!0},this.display_attr=function(b,c){var d=new Date,e=[{vname:b,status:!0,timestamp:Date.parse(d)+"."+d.getMilliseconds()}],f=c.root.attr("data-vmodel-history");if(f){var g=a.parseJSON(f);g.push(e[0]),e=g}var h=JSON.stringify(e);c.root.attr("data-vmodel-history",h)},this.param_match=function(b,c,d){var e=[],f=a.type(b);return b?"string"==f&&(e=[b,c,d]):e=[b,null,null],e};var g=f.param_match(b,d,e),b=g[0],h=g[1],i=g[2];if(g=d=e=null,!b)return a.vmodel.api.obj_sort(c);var j=c[b];if(!j)return console.log("呼叫的倉儲名稱 "+b+" 不存在。"),!1;if("boolean"==a.type(h)&&1==h){var k=a.vmodel.api.get_autoload_funame(j),l=(a.vmodel.api.is_trigger_autoload(j,k),a.type(i));if("function"==l||"boolean"==l&&1==i){"function"==l&&(j.vmodel_get_callback=function(){i(j)});var m=setInterval(function(){if(1==f.chk_trigger_callback(j)){if(clearInterval(m),f.display_attr(b,j),"boolean"==l)return!0;j.vmodel_get_callback()}},20);return!0}}return c[b]},a.vmodel["delete"]=function(a){return a||""==a?c[a]&&delete c[a]:c={},this},a.vmodel.create=function(b){var d=this,e=b.selector;return this.msg_error=function(a,b){console.log("錯誤：『"+e+"』呼叫的 function 『"+a+"』："+b)},this.define_autoload_struct=function(b,c){a.each(c,function(a,c){b.fun_struct[c]=!1})},this.ext_expend=function(b,c){var d=null!=c?c:null;return a.extend(b,{vname:d,selector:e,root:a(e),fun_struct:{},struct:function(c,d){if("boolean"==a.type(d)||d||(d=!0),"string"==a.type(c)){if("boolean"!=a.type(b.fun_struct[c]))return console.log("找不到名稱為 "+c+"的建構狀態"),!1;b.fun_struct[c]=d}else{if("array"!=a.type(c))return console.log("建構名稱須要指定"),!1;a.each(c,function(a,c){b.fun_struct[c]=d})}return!0}}),b},this.put_storage=function(a,b){if(null!=a){if(c[a])return console.log("倉儲名稱『"+a+"』重複。"),!1;c[a]=b}},this.main=function(b){try{if(!a.vmodel.api.isallow_jqver(!1))throw a.vmodel.api.isallow_jqver(!0);a.vmodel.api.check_input_param({selector:b.selector,model_name:b.model,isautoload:b.isautoload,method:b.method});var c=a.vmodel.api.vmodel_param_match(b.selector,b.model,b.isautoload,b.method),e=(c[0],c[1]),f=c[2],g=c[3],g=d.ext_expend(g,e),h=a.vmodel.api.get_autoload_funame(g);if(d.define_autoload_struct(g,h),d.put_storage(e,g),f===!0){var i=a.vmodel.api.is_trigger_autoload(g,h);i===!1&&d.msg_error("is_trigger_autoload","發生錯誤")}return this}catch(j){return console.log(j),!1}},d.main(b)},a.fn.vmodel=function(b,c,d,e){var f=this;return this.main=function(b,c,d,e){try{if(!a.vmodel.api.isallow_jqver(!1))throw a.vmodel.api.isallow_jqver(!0);a.vmodel.api.check_input_param({selector:b,model_name:c,isautoload:d,method:e});var f=a.vmodel.api.vmodel_param_match(b,c,d,e),g=f[0],h=f[1],i=f[2],j=f[3];return a.vmodel.create({selector:g,model:"--"+h,isautoload:i,method:j})}catch(k){return console.log(k),!1}},f.main(b,c,d,e)}}(jQuery);
//# sourceMappingURL=jquery.vmodel.min.js.map